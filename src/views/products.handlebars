<ul>
    <li>Productos</li>
    <li><a href="/api/cart">üõí</a></li>
    <li><a href="/profile">Mi perfil</a></li>
</ul>

<h2>¬°Bienvenido, {{userData.first_name}} {{userData.last_name}}!</h2>
<h2>Eres un {{userData.role}}</h2>

<ul>
    <li><a href="/api/products?sort=asc">Menor a mayor</a></li>
    <li><a href="/api/products?sort=desc">Mayor a menor</a></li>
    <li><a href="/api/products?stock">Solo con stock</a></li>
    <li><p>Para buscar por categor√≠a usar ?query=(nombre de la categor√≠a) en la URL. Hay 6 productos con categor√≠a "ropa" y 3 con "casa". Para probar la funci√≥n usar este link:</p> <br> 
    <a href="/api/products?query=casa">Categor√≠a casa</a></li>
</ul>

<br>

{{#if this.result.isValid}}

<div>
    {{#if this.result.hasPrevPage}}
        <a href={{this.result.prevLink}}>‚¨Ö</a>
    {{/if}}
    &nbsp;
    {{this.result.page}}
    &nbsp;
     {{#if this.result.hasNextPage}}
        <a href={{this.result.nextLink}}>‚û°</a>
    {{/if}} 
</div>

<br>

<div>
    {{#each this.result.docs}}
    <div class="product">
        <p>{{this.title}} &nbsp; Descripci√≥n: {{this.description}}</p>
        <p>Precio: $ {{this.price}} &nbsp; Stock: {{this.stock}}</p>
        <p>Categor√≠a: {{this.category}}</p>
        <p>{{this._id}}</p>
        
        {{#if userData.isAdmin}}
            <h3>üõ† Controles de edici√≥n de productos</h3>
        {{else}}
            <button class="addBtn" dataProductId="{{this._id}}">+</button>
        {{/if}}
    </div>
    <br/>
{{/each}}
</div>
<br/>


{{else}}
<h1>No hay productos para mostrar</h1>
{{/if}}

<script>
    document.addEventListener('DOMContentLoaded', () => {
    const addBtns = document.querySelectorAll('.addBtn');

    addBtns.forEach(addBtn => {
        addBtn.addEventListener('click', async () => {
            const productId = addBtn.getAttribute('dataProductId');

            fetch(`/api/cart/addToCart?productId=${productId}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error('Error al a√±adir producto al carrito:', error));
        });
    });
});

</script>